<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
	<script src="./javascripts/analytics.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Weather-gridGL by briegn1</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Weather-gridGL</h1>
          <h2>Examples of how to convert gridded data into LeafletJS WebGL overlays</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/briegn1/weather-gridGL/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/briegn1/weather-gridGL/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/briegn1/weather-gridGL" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h3>
<a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is Weather-gridGL?</h3>

<p>While not yet spun off into a distinct product, this is a workflow/set of examples to show two things:<br>
	1) How to use python to convert data on a latitude/longitude grid into a format that can efficiently be stored and 	
		transferred, as well as one that is compatible with WebGL visualization techniques.<br>
	2) How to use WebGL, Javascript, and LeafletJS to display the converted gridded data over a slippy web map.</p>

<h3>
<a id="designer-templates" class="anchor" href="#designer-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why?</h3>

<p>A never-ending challenge in designing websites in the field of atmospheric sciences is how to effectively and efficiently 
	overlay gridded model output on an interactive map. A traditional answer to this problem includes generating static map tiles, which
	require a lot of storage space or extremely efficient pipelines of data transfer. Other methods include computing contours
	and generating geoJSONs from the data and coordinates, but this requires a lot of time-consuming preprocessing and a
	great deal of work to style the layers appropriately.</p><br>
<p>What the weather-gridGL approach does is abstract the data into pre-assigned ranges for visualization, store it in relatively
	lightweight JSONs that are comprised of single arrays of integers (although I am open to suggestions for even more efficient 
	storage and transfer options), and overlay them on a LeafletJS map.</p>

<h3>
<a id="rather-drive-stick" href="./simple.html">Simple Example</a></h3>
<a href="./simple.html"><img src="./images/simple.png" alt="Simple Example" height="620" width="620"></a>
<p>The simplest example I have put together is just a small domain (Wasatch Front, Utah) chunk of the 2.5km National Digital Forecast Database (NDFD) Grid. This should load quickly
	on any browser/computer. The simple.py script that is used to create the dataset uses the latitude/longitude grid definitions to create the vertices
	for the webGL scene. The temperature, relative humidity, wind speed, and accumulated precipitation data comes from grib2 files provided by the National Weather Service.
	Care is taken when creating the arrays to ensure that the output arrays are in the proper format for having WebGL create a TRIANGLE_STRIP from the grid, best explained 
	<a href="http://www.corehtml5.com/trianglestripfundamentals.php">here</a>. The data is binned using the variable-specific functions at the top of the simple.py code, 
	with any extreme values (1e20 in the case of NDFD) given the highest index value, so that its color equivalent can be transparent in the eventual visualization.
</p><br>
<p>On the web side of things, a few packages are included, as well as some styling for both the page and for LeafletJS. The two webGL shaders are defined (they can be put in separate GLSL files
	as well if you'd prefer - and they are quite basic, to be honest), and the map div is established. The latitude/longitude coordinates are also pulled in at page load as they only need to be loaded once.
	All of the magic is done on the JavaScript side. The map is created using <a href="http://leafletjs.com">LeafletJS</a>
	with custom-made <a href="https://www.mapbox.com">Mapbox</a> tiles that serve an important purpose. The style makes landmasses transparent, so that the grids can show through, but which places
	the labels on top of the grids for geographical reference. The WebGL environment is then created, the color scales are defined for each variable, and data is acquired from the files
	generated by simple.py using JQuery for Ajax requests. JQuery is by no means mandatory in this, and other frameworks or just native JavaScript can be used to pull in the files.
</p><br>
<p>When the data is acquired, the integer values are converted by the color scale dictionary to RGB values for each point. When new files are loaded (using the 'W' or 'D' keys to change variable),
	only the colors are updated, not the vertices (which remain the same) for efficiency. When the screen is moved or the zoom is changed, the transform matrix is updated, not the vertices. This is
	using code from Stanislav Sumbera (<a href="https://github.com/Sumbera" class="user-mention">@Sumbera</a>) from the <a href="http://blog.sumbera.com/2014/06/08/leaflet-webgl-many-points-rendering/">Leaflet
	WebGL Many Points Rendering</a> example.
</p>
<h3>
<a id="rather-drive-stick" href="./eastCoast.html" >East Coast Example</a></h3>
<a href="./eastCoast.html" ><img src="./images/eastCoast.png" alt="East Coast Example" height="620" width="620"></a>
<p>This example requires a bit more heavy lifting, but the WebGL should render within 0.1-0.5 seconds. Here we have a chunk of the NDFD grids covering much of the
	East Coast of the United States. I have added some custom LeafletJS controls including a legend for each of the variable color bars, a time stamp for each forecast period,
	instructions for the key controls in the bottom left, and the option not just to change variables, but to move forward and backward in time through the forecast periods (note
	that because of the static nature of the dataset, the forecasts do not update. For a regularly-updating version, go <a href="http://home.chpc.utah.edu/~u0732636/webGL/NDFD_GLTest.html">here</a>).
</p>
<h3>
<a id="rather-drive-stick" href="./imWest.html" >Intermountain West Example</a></h3>
<a href="./imWest.html" ><img src="./images/imWest.png" alt="Intermountain West Example" height="620" width="620"></a>
<p>This example is more for those with solid Internet speeds and a decent graphics card - the WebGL should render in about 0.35-1.0 seconds. Here we have a chunk of the NDFD grids covering the Intermountain
	West region of the United States. All of the controls are identical to the East Coast example. 
	For a regularly-updating version of this website, go <a href="http://home.chpc.utah.edu/~u0732636/webGL/utGLTest2.html">here</a>).
</p>
<h3>
<a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support or Contact</h3>

<p>Questions, comments, or suggestions? Contact <a href="matt.lammers@utah.edu">matt.lammers@utah.edu</a>.</p>
        </section>

        <footer>
          Weather-gridgl is maintained by <a href="https://github.com/briegn1">briegn1</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>